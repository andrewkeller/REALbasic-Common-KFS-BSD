<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 TRANSITIONAL//EN">
<html>
	<head>
		<title>ProgressDelegateKFS - REALbasic Common KFS BSD Library Documentation</title>
		<link rel="stylesheet" href="../../style.css">
	</head>
	<body>
		<h1>REALbasic Common KFS BSD Library Documentation</h1>
		<div id="tnb" class="hlinks">
			<a href="../../index.html">Index</a>
			<a class="act">Core</a>
			<a href="../../download.html">Download</a>
			<a href="../../usingwithvc.html">Using with Git</a>
			<a href="../../usingwithrb.html">Using with REAL Studio</a>
		</div>
		<div class=docblock>
			<h2>ProgressDelegateKFS <span class=cd>(Inherits from Object)</span></h2>
			<p>This class allows multiple distinct distributed processes to report progress such that a single ProgressBar can be smoothly updated without any of the processes needing to know about each other.</p>
			<p>The basic idea is that you give a reference to a ProgressDelegateKFS that you've configured to update a ProgressBar to one of your processes.  Then, that process spawns a ProgressDelegateKFS child for every one of its subprocesses.  Then, the ProgressDelegateKFS class does the math for you to figure how far along your process is overall.  This technique creates a tree of distinct ProgressDelegateKFS objects, each of which is feeding information to the root, which updates your ProgressBar.</p>
			
			<h2>Delegates</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>MessageEventMethod</h1>
					<h2>MessageEventMethod( pgd As ProgressDelegateKFS, new_message As String )</h2>
					<p>The signature of the method used by message event callbacks.  The parameters are a reference to the ProgressDelegateKFS object that invoked the handler, and the new message.</p>
				</div>
				<div class="unit">
					<h1>SignalEventMethod</h1>
					<h2>SignalEventMethod( pgd As ProgressDelegateKFS, new_message As String )</h2>
					<p>The signature of the method used by signal event callbacks.  The parameters are a reference to the ProgressDelegateKFS object that invoked the handler, and the new signal.</p>
				</div>
				<div class="unit">
					<h1>ValueEventMethod</h1>
					<h2>ValueEventMethod( pgd As ProgressDelegateKFS, new_value As Double, new_indeterminatevalue As Boolean )</h2>
					<p>The signature of the method used by value event callbacks.  The parameters are a reference to the ProgressDelegateKFS object that invoked the handler, and both components of the new value.</p>
				</div>
			</div>
			
			<h2>Enumerations</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>Modes</h1>
					<h2>Modes As Integer</h2>
					<p>Defines each possible mode of a ProgressDelegateKFS object.  Values include:
						<ul>
							<li>FullSynchronous</li>
							<li>ThrottledSynchronous</li>
							<li>InternalAsynchronous</li>
							<li>ExternalAsynchronous</li>
						</ul>
					</p>
					<p>In FullSynchronous mode, every change to a ProgressDelegateKFS node gets propagated to its parent immediately.  This has the advantage of creating a very active user interface, however in algorithms where time is precious, updating the progress very often can waste a lot of time.  Consider using ThrottledSynchronous mode in this case.</p>
					<p>In ThrottledSynchronous mode, progress updates are sent to the parent node only if the Frequency has expired since the last update.  This has the disadvantage of creating a less active user interface, however in algorithms where time is precious, this mode ensures that time is not wasted updating the progress too often.  This mode is the default mode for new ProgressDelegateKFS objects.</p>
					<p>In InternalAsynchronous mode, progress is polled internally according to the Frequency property.</p>
					<p>In ExternalAsynchronous mode, progress is not calculated or updated automatically in any way.  It is expected that an external mechanism is used to poll the new values.</p>
				</div>
				<div class="unit">
					<h1>Signals</h1>
					<h2>Signals As Integer</h2>
					<p>Defines each possible signal supported by the ProgressDelegateKFS class.  Values include:
						<ul>
							<li>Normal</li>
							<li>Pause</li>
							<li>Cancel</li>
							<li>Kill</li>
						</ul>
					</p>
					<p>Signals do not "do" anything by themselves.  The intention of signals is to allow the user interface (or any node N in a tree of ProgressDelegateKFS objects) to send a message to the working processes (or all the children of node N).</p>
					<p>A working process can check for signals by either polling or by providing a callback to its local ProgressDelegateKFS object (or both).</p>
				</div>
			</div>
			
			<h2>Events</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>MessageChanged</h1>
					<h2>MessageChanged( new_message As String )</h2>
					<p>Invoked when the value of Message(True) changes.  This includes the children.  The new message is provided.</p>
					<p>This event is not raised every time the message is set.  Instead, it remembers what the old message was, and only fires when the message has actually changed.</p>
				</div>
				<div class="unit">
					<h1>Open</h1>
					<h2>Open()</h2>
					<p>Invoked when the object is initialized for the first time.</p>
				</div>
				<div class="unit">
					<h1>SignalChanged</h1>
					<h2>SignalChanged( new_signal As Signals )</h2>
					<p>Invoked when the signal has changed.  The new signal is provided.</p>
					<p>When a signal is set, the signal is propagated throughout the entire tree of ProgressDelegateKFS objects before this event is raised.  This event is raised for every node where the signal actually changed, starting with the children, working down to the root node.  This event is not raised for nodes where setting the signal did not actually change the signal.</p>
				</div>
				<div class="unit">
					<h1>ValueChanged</h1>
					<h2>ValueChanged( new_value As Double, new_indeterminatevalue As Boolean )</h2>
					<p>Invoked when the value of Value(True) changes.  Both components of the new value are provided.</p>
					<p>This event is not raised every time the value is set.  Instead, it remembers what the old value was, and only fires when the value has actually changed.</p>
					<p>Additionally, the frequency of this event firing is subject to the value of the Frequency property when in ThrottledSynchronous or InternalAsynchronous mode.</p>
				</div>
			</div>
			
			<h2>Constructors</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>[default]</h1>
					<h2>New ProgressDelegateKFS</h2>
					<p>Creates a new ProgressDelegateKFS object.  The default configuration is:
						<ul>
							<li>Objects to update: None</li>
							<li>Callbacks to invoke: None</li>
							<li>Children: None</li>
							<li>TotalWeightOfChildren: 0</li>
							<li>Frequency: 0.5 Seconds</li>
							<li>IndeterminateValue: True</li>
							<li>Message: ""</li>
							<li>Mode: ThrottledSynchronous</li>
							<li>Parent: Nil</li>
							<li>Signal: Normal</li>
							<li>Value: 0</li>
							<li>Weight: 1</li>
						</ul>
					</p>
				</div>
				<div class="unit">
					<h1>ProgressDelegateKFS, Double, Double, String</h1>
					<h2>New ProgressDelegateKFS( new_parent As ProgressDelegateKFS, new_weight As Double, new_value As Double, new_msg As String )</h2>
					<p>Creates a new ProgressDelegateKFS object that is a child of the given ProgressDelegateKFS object.  The default configuration is:
						<ul>
							<li>Objects to update: None</li>
							<li>Callbacks to invoke: None</li>
							<li>Children: None</li>
							<li>TotalWeightOfChildren: 0</li>
							<li>Frequency: 0.5 Seconds</li>
							<li>IndeterminateValue: True</li>
							<li>Message: ""</li>
							<li>Mode: Inherited from parent, except InternalAsynchronous maps to ExternalAsynchronous</li>
							<li>Parent: The given object</li>
							<li>Signal: Inherited from parent</li>
							<li>Value: The given value</li>
							<li>Weight: The given weight</li>
						</ul>
					</p>
				</div>
			</div>
			
			<h2>Properties</h2>
			<div class="attrlist">
				<div class="unit readonly">
					<h1>ChildCount</h1>
					<h2>ChildCount() As Integer</h2>
					<p>Returns the number of ProgressDelegateKFS objects that are first children of this object.  This does not include past children which have been deallocated and no longer exist.</p>
				</div>
				<div class="unit readonly">
					<h1>Children</h1>
					<h2>Children() As ProgressDelegateKFS()</h2>
					<p>Returns an array of the ProgressDelegateKFS objects that are first children of this object.  This does not include past children which have been deallocated and no longer exist.</p>
					<p>The order of the array is currently undefined.</p>
				</div>
				<div class="unit">
					<h1>Frequency</h1>
					<h2>Frequency() As DurationKFS</h2>
					<h2>Frequency( Assigns new_value As DurationKFS )</h2>
					<p>When in ThrottledSynchronous mode, this is the amount of time that must pass before a ValueChanged or MessageChanged event will be recognized.</p>
					<p>When in InternalAsynchronous mode, this is the frequency of the polling.</p>
					<p>In all other modes, this property is ignored.</p>
				</div>
				<div class="unit">
					<h1>IndeterminateValue</h1>
					<h2>IndeterminateValue( Assigns new_value As Boolean )</h2>
					<h2>IndeterminateValue( include_children As Boolean = True ) As Boolean</h2>
					<p>Tells whether or not progress cannot be determined.  Metaphorically equivalent to a ProgressBar object with the Maximum set to zero.  Default value is True.  Becomes False automatically if the Value property is set in any way, including via a child deallocating and incrementing the value of its parent.</p>
				</div>
				<div class="unit">
					<h1>Message</h1>
					<h2>Message( Assigns new_value As String )</h2>
					<h2>Message( search_harder_for_result As Boolean = True ) As String</h2>
					<p>A textual message describing the process that is currently using the ProgressDelegateKFS object.</p>
				</div>
				<div class="unit">
					<h1>Mode</h1>
					<h2>Mode() As Modes</h2>
					<h2>Mode( Assigns new_value As Modes )</h2>
					<p>The mode that the ProgressDelegateKFS object is currently operating in.  Can be any of the items in the Modes enumeration.</p>
				</div>
				<div class="unit readonly">
					<h1>Parent</h1>
					<h2>Parent() As ProgressDelegateKFS</h2>
					<p>Returns a reference to the parent of the object, assuming that there is currently a tree of ProgressDelegateKFS objects.  Returns Nil if no parent exists.</p>
				</div>
				<div class="unit">
					<h1>ShouldAutoUpdateObject</h1>
					<h2>ShouldAutoUpdateObject( obj As Object ) As Boolean</h2>
					<h2>ShouldAutoUpdateObject( obj As Object, Assigns new_value As Boolean )</h2>
					<p>Sets or tells whether or not the given object should be automatically updated to reflect the properties of this ProgressDelegateKFS object.</p>
					<p>Currently, only ProgressBars and Labels are supported.  A ProgressBar will get its value updated according to the Value property, and its maximum updated according to the IndeterminateValue property.  A Label will get its caption updated according to the Message property.</p>
					<p>Registering an unsupported object for automatic updates does not result in any error or malfunction.</p>
					<p>When an object is registered, it is updated immediately.  The object will then remain up-to-date according to the current mode.</p>
				</div>
				<div class="unit">
					<h1>ShouldInvokeMessageChangedCallback</h1>
					<h2>ShouldInvokeMessageChangedCallback( d As MessageEventMethod ) As Boolean</h2>
					<h2>ShouldInvokeMessageChangedCallback( d As MessageEventMethod, Assigns new_value As Boolean )</h2>
					<p>Sets or tells whether or not the given method should be invoked when the message changes.</p>
					<p>When a method is registered, it is invoked immediately.  The object will then be invoked subsequently according to the current mode.</p>
				</div>
				<div class="unit">
					<h1>ShouldInvokeSignalChangedCallback</h1>
					<h2>ShouldInvokeSignalChangedCallback( d As SignalEventMethod ) As Boolean</h2>
					<h2>ShouldInvokeSignalChangedCallback( d As SignalEventMethod, Assigns new_value As Boolean )</h2>
					<p>Sets or tells whether or not the given method should be invoked when the signal changes.</p>
					<p>When a method is registered, it is invoked immediately.  The object will then be invoked subsequently according to the current mode.</p>
				</div>
				<div class="unit">
					<h1>ShouldInvokeValueChangedCallback</h1>
					<h2>ShouldInvokeValueChangedCallback( d As ValueEventMethod ) As Boolean</h2>
					<h2>ShouldInvokeValueChangedCallback( d As ValueEventMethod, Assigns new_value As Boolean )</h2>
					<p>Sets or tells whether or not the given method should be invoked when the value changes.</p>
					<p>When a method is registered, it is invoked immediately.  The object will then be invoked subsequently according to the current mode.</p>
				</div>
				<div class="unit">
					<h1>SigCancel</h1>
					<h2>SigCancel() As Boolean</h2>
					<h2>SigCancel( Assigns new_value As Boolean )</h2>
					<p>Represents whether or not SigCancel is currently set.</p>
					<p>When setting, all of the children also receive this signal.</p>
				</div>
				<div class="unit">
					<h1>SigKill</h1>
					<h2>SigKill() As Boolean</h2>
					<h2>SigKill( Assigns new_value As Boolean )</h2>
					<p>Represents whether or not SigKill is currently set.</p>
					<p>When setting, all of the children also receive this signal.</p>
				</div>
				<div class="unit">
					<h1>Signal</h1>
					<h2>Signal() As Signals</h2>
					<h2>Signal( Assigns new_value As Signals )</h2>
					<p>The currently active signal.</p>
					<p>When setting, all of the children also receive the new signal.</p>
				</div>
				<div class="unit">
					<h1>SigNormal</h1>
					<h2>SigNormal() As Boolean</h2>
					<h2>SigNormal( Assigns new_value As Boolean )</h2>
					<p>Represents whether or not SigNormal is currently set.</p>
					<p>When setting, all of the children also receive this signal.</p>
					<p>Setting SigNormal to False currently does nothing.</p>
				</div>
				<div class="unit">
					<h1>SigPause</h1>
					<h2>SigPause() As Boolean</h2>
					<h2>SigPause( Assigns new_value As Boolean )</h2>
					<p>Represents whether or not SigPause is currently set.</p>
					<p>When setting, all of the children also receive this signal.</p>
				</div>
				<div class="unit">
					<h1>TotalWeightOfChildren</h1>
					<h2>TotalWeightOfChildren() As Double</h2>
					<h2>TotalWeightOfChildren( Assigns new_value As Double )</h2>
					<p>The sum of all the weights of all the children.  Default value is zero.</p>
					<p>The purpose of this property is to allow for a way to get the overall value to slide gracefully from zero to one even when not all the children exist at the same time.  If all the children were created in parallel at the same time, then the process is easy.  Just add up the weights and do some math.  But, if not all of the children have been created yet, or if some of the children have already been deallocated, then some of the information for calculating the weights is missing.  With this property, you can tell a ProgressDelegateKFS object the total weight of all the children (if you know it), such that the relative weights of the existing children can be correctly handled.</p>
					<p>When the weight of a ProgressDelegateKFS object is set (and when the object is first created), the TotalWeightOfChildren property of its parent is automatically updated to make sure it is at least the total weight of the current children.  This allows for you, as the user of this class, to not need to care about this property when the children are operating in parallel rather than in series.  This property only exists for when the children are operating in series.</p>
				</div>
				<div class="unit">
					<h1>Value</h1>
					<h2>Value( Assigns new_value As Double )</h2>
					<h2>Value( include_children As Boolean = True ) As Double</h2>
					<p>The current value of this object.  Can optionally include the children, according to the relative weights.  Possible values range from 0 to 1.  Setting this value also sets IndeterminateValue to False.</p>
				</div>
				<div class="unit">
					<h1>Weight</h1>
					<h2>Weight() As Double</h2>
					<h2>Weight( Assigns new_value As Double )</h2>
					<p>The weight of just this object.  Only used by a parent object, if one exists.  Allows for one child to be "worth" more than another.</p>
					<p>When this property is set, the TotalWeightOfChildren property of the parent node is updated to make sure that it is at least the total weight of the current children.</p>
				</div>
			</div>
			
			<h2>Methods</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>Flush</h1>
					<h2>Flush( ignore_throttle As Boolean = False, ignore_diff As Boolean = False )</h2>
					<p>Manually invokes an update that propagates down the tree, calling MessageChanged and ValueChanged events as it goes.  Optionally, this operation can ignore the throttle (when in ThrottledSynchronous mode), or it can ignore the currently known difference in data (raise the event even though data suggests that the value hasn't changed).</p>
					<p>Flush treats all Asynchronous modes as FullSynchronous.  Instructing the flush to ignore the throttle effectively makes the flush treat all modes as FullSynchronous.</p>
					<p>If ignore_throttle is False and the flush encounters a node in ThrottledSynchronous mode with an unexpired throttle, the flush stops there.  If ignore_diff is False and the flush encounters a node where the data suggests that the value has not changed, then the flush stops there.</p>
					<p>Because Flush cannot fully respect Mode property, it is not optimal for normal use.  This method was initially created for debugging purposes.  There is nothing stopping a tree of ProgressDelegateKFS objects from becoming large and complex, with many branches and mixed modes.  If progress updates are not making it to the root node for some reason, it is useful to have a way to temporarily force progress updates down the tree with a single command, to help narrow down where the problem may be.</p>
				</div>
				<div class="unit">
					<h1>SpawnChild</h1>
					<h2>SpawnChild( new_weight As Double = 1, new_value As Double = 0, new_msg As String = "" ) As ProgressDelegateKFS</h2>
					<p>Returns a ProgressDelegateKFS object that is a child of the current object.  The child's value is automatically incorporated into the parent's Value property, according to the weight of the child.  When the child deallocates, the entire relative weight of the child is automatically added to the parent, regardless of the child's value.</p>
				</div>
			</div>
			
			<h2>Shared Methods</h2>
			<div class="attrlist">
				<div class="unit">
					<h1>SetMessage</h1>
					<h2>SetMessage( pgd As ProgressDelegateKFS, msg As String )</h2>
					<p>Sets the message of the given ProgressDelegateKFS object.  If the object is Nil, then no action is taken.  Comes in handy in complex algorithms, where one more If statement makes things more cluttered.</p>
				</div>
				<div class="unit">
					<h1>SetValue</h1>
					<h2>SetValue( pgd As ProgressDelegateKFS, v As Double )</h2>
					<p>Sets the value of the given ProgressDelegateKFS object.  If the object is Nil, then no action is taken.  Comes in handy in complex algorithms, where one more If statement makes things more cluttered.</p>
				</div>
			</div>
			
			<h2>Compatibility</h2>
			<div>
				<p>This class is compatible with console applications, and should work on all platforms.</p>
				<p>This class is thread safe.</p>
			</div>
			
			<h2>Notes</h2>
			<div>
				<p>In general, this class is used to report the progress of a process that is made up of many pieces.  It still works in simpler situations, but it might be overkill.</p>
				<p>The previous version of this class was implemented using a simple stack.  This was much simpler, however it did not support reporting progress from more than one subprocess at a time.  Since the current version is implemented as a tree, a fully distributed process can seamlessly report progress to a single ProgressBar.</p>
				<p>This class supports automatically updating a ProgressBar object or a Label object.  If you would like more custom functionality, this class supports registering callbacks when the current value or message changes.  Or, if you would prefer the simple way, you can have a ProgressDelegateKFS object on a Window, and in the ValueChanged and MessageChanged events, update the controls on your window.</p>
				<p>The simple case of using this class is as follows.  Place a ProgressDelegateKFS object on a window, right next to your ProgressBar and Label for displaying progress.  In the Open event of the ProgressDelegateKFS object, add the ProgressBar and the label as automatically updated objects.  When you run your process, give it a reference to the ProgressDelegateKFS object on the Window.  As the process runs, it should set the message and the value of its local ProgressDelegateKFS object.  After that, it all just works.</p>
			</div>
			
			<h2>See Also</h2>
			<div class="hlinks">
				<a href="http://docs.realsoftware.com/index.php/Label">Label</a>
				<a href="http://docs.realsoftware.com/index.php/ProgressBar">ProgressBar</a>
				<a href="http://docs.realsoftware.com/index.php/WeakRef">WeakRef</a>
			</div>
		</div>
	</body>
</html>
